# Mortar Language

[![license](https://img.shields.io/badge/license-MIT%2FApache--2.0-blue)]()
[![Crates.io](https://img.shields.io/crates/v/mortar_language.svg)](https://crates.io/crates/mortar_language)
[![Documentation](https://docs.rs/mortar_language/badge.svg)](https://docs.rs/mortar_language)
[![codecov](https://codecov.io/gh/Bli-AIk/mortar_language/graph/badge.svg?token=)](https://codecov.io/gh/Bli-AIk/mortar_language)

<img src="https://img.shields.io/badge/Rust-000000?style=for-the-badge&logo=rust&logoColor=white" />

![mortar_logo](https://raw.githubusercontent.com/Bli-AIk/mortar/refs/heads/main/crates/mortar_logo.svg)

**Mortar** æ˜¯ä¸€ä¸ªä¸ºæ¸¸æˆå¯¹è¯ä¸æ–‡å­—äº‹ä»¶ç³»ç»Ÿè®¾è®¡çš„é¢†åŸŸç‰¹å®šè¯­è¨€ï¼ˆDSLï¼‰ï¼Œæ ¸å¿ƒç†å¿µæ˜¯å®ç° **æ–‡æœ¬å†…å®¹ä¸äº‹ä»¶é€»è¾‘çš„ä¸¥æ ¼åˆ†ç¦»**ã€‚

é˜…è¯» [å®˜æ–¹æŒ‡å—](https://bli-aik.github.io/mortar/zh-hans/) æ¥å­¦ä¹ å¦‚ä½•ä½¿ç”¨ mortar å§ï¼

| è‹±è¯­                             | ç®€ä½“ä¸­æ–‡ |
|--------------------------------|------|
| [English Version](./readme.md) | ç®€ä½“ä¸­æ–‡ |

## ç®€ä»‹

Mortar çš„çµæ„Ÿæ¥è‡ª [ink](https://github.com/inkle/ink) ä¸ [Yarn Spinner](https://github.com/YarnSpinnerTool/YarnSpinner)ï¼Œ
ä½†å®ƒçš„æ ¸å¿ƒåŒºåˆ«åœ¨äºï¼š

> **Mortar æ—¨åœ¨å®ç°æ–‡æœ¬å†…å®¹ä¸äº‹ä»¶é€»è¾‘çš„ä¸¥æ ¼åˆ†ç¦»ã€‚**

* **æ–‡æœ¬éƒ¨åˆ†**ï¼šçº¯å™äº‹å†…å®¹ï¼Œå®Œå…¨ä¸ºäººç±»ç¼–å†™ï¼Œä¸æ··å…¥äº‹ä»¶é€»è¾‘ï¼›
* **äº‹ä»¶éƒ¨åˆ†**ï¼šç³»ç»Ÿæ‰§è¡ŒæŒ‡ä»¤ï¼Œç”¨äºæ§åˆ¶å‘ˆç°æ•ˆæœï¼Œä¸æ–‡æœ¬å†…å®¹æ— å…³ï¼›
* **Mortar è¯­è¨€æœ¬èº«**ï¼šæä¾›ä¸€ç§ä¼˜é›…çš„æ¡¥æ¢ï¼Œè®©ä¸¤è€…èƒ½æ¸…æ™°å…³è”ã€äº’ä¸æ±¡æŸ“ã€‚

> `Mortar Language` æ˜¯ SoupRune é¡¹ç›®çš„è¡ç”Ÿå·¥å…·ï¼Œæ˜¯å…¶å¯¹è¯ç³»ç»Ÿçš„é¦–é€‰è¯­è¨€ã€‚
>
> SoupRune æ˜¯ä¸“é—¨é’ˆå¯¹ Deltarune / Undertale Fangame çš„æ¸¸æˆæ¡†æ¶ã€‚[äº†è§£æ›´å¤š](https://github.com/Bli-AIk/souprune)ã€‚

## è®¾è®¡ç›®æ ‡

Mortar çš„è®¾è®¡éµå¾ªä»¥ä¸‹æ ¸å¿ƒåŸåˆ™ï¼š**å†…å®¹åˆ†ç¦»ã€è¯­ä¹‰æ¸…æ™°ã€ç¨‹åºå‹å¥½ã€é™æ€ç±»å‹ã€‚**

1. **å†…å®¹ä¸é€»è¾‘è§£è€¦**ï¼šäº‹ä»¶ä»¥å­—ç¬¦ç´¢å¼•è§¦å‘ï¼Œé¿å…å¯Œæ–‡æœ¬æ ‡è®°æ±¡æŸ“å†…å®¹ï¼›æ–‡æœ¬ä¸­ä¸å«æ§åˆ¶æ ‡è®°ï¼Œä¿æŒçº¯å‡€ï¼›
2. **è¯­ä¹‰æ¸…æ™°**ï¼šé‡‡ç”¨ Rust é£æ ¼çš„è¯­æ³•è®¾è®¡ï¼ŒDSL è¯­æ³•ç›´è§‚ã€æ˜“è¯»ã€æ˜“ç»´æŠ¤ï¼›
3. **ç¨‹åºå‹å¥½**ï¼šä»¥ JSON ç»“æ„è¿›è¡Œç¼–è¯‘ï¼Œæ”¯æŒä½¿ç”¨è€…è¿›è¡Œé’ˆå¯¹æ€§çš„è§£æï¼›
4. **é™æ€ç±»å‹**ï¼šä½œä¸ºé™æ€ç±»å‹è¯­è¨€ï¼Œç¼–è¯‘æ—¶è¿›è¡Œç±»å‹æ£€æŸ¥ä»¥æå‰æ•è·ç±»å‹é”™è¯¯ï¼Œæé«˜è¿è¡Œæ—¶å¯é æ€§ã€‚

## å¿«é€Ÿä¸Šæ‰‹

### å®‰è£…

```bash
# ä» crates.io å®‰è£…å‘½ä»¤è¡Œå·¥å…·
cargo install mortar_cli

# æˆ–ä»æºç æ„å»º
git clone https://github.com/Bli-AIk/mortar.git
cd mortar
cargo build --release
```

### åŸºæœ¬ç”¨æ³•

åˆ›å»ºä¸€ä¸ªç®€å•çš„ Mortar æ–‡ä»¶ `hello.mortar`ï¼š

```mortar
// â€˜nodeâ€™ å°±æ˜¯ä¸€ä¸ªåŸºæœ¬çš„å¯¹è¯èŠ‚ç‚¹ã€‚
// ä¹Ÿå¯ä»¥ç¼©å†™ä¸º â€˜ndâ€™ï¼
node Start {
    // ç¼–å†™ä½ çš„æ–‡æœ¬å†…å®¹ã€‚
    // åŒå¼•å·ï¼ˆæˆ–å•å¼•å·ï¼‰æ˜¯å¿…é¡»çš„ï¼Œä½†åˆ†å·å’Œé€—å·å¯ä»¥çœç•¥ï¼
    text: "ä½ å¥½å‘€ï¼Œæ¬¢è¿é˜…è¯»è¿™ä¸ªäº’åŠ¨æ•…äº‹ã€‚"

    // è¿™ä¸ªäº‹ä»¶åˆ—è¡¨å†™åœ¨ç´§æŒ¨ç€ä¸Šä¸€ä¸ª textï¼Œæ‰€ä»¥å®ƒä»¬æ˜¯å…³è”çš„ã€‚
    events: [
        // ä½¿ç”¨ ç´¢å¼• + äº‹ä»¶ å‡½æ•° çš„æ–¹å¼æ¥ç¼–å†™äº‹ä»¶ã€‚æ”¯æŒé“¾å¼å†™æ³•ã€‚
        // è¿™é‡Œçš„ç´¢å¼•è¡¨ç¤ºäº‹ä»¶è§¦å‘çš„å­—ç¬¦ä½ç½®ï¼ˆä» 0 å¼€å§‹è®¡æ•°ï¼‰ã€‚
        // å®ƒä¼šç»‘å®šåˆ°ä½ çš„æ¸¸æˆå…·ä½“å®ç°â€”â€”æ‰“å­—æœºæ’­æ”¾çš„ä½ç½®ï¼ŸéŸ³é¢‘æ—¶é—´è½´ï¼Ÿè¿˜æ˜¯åˆ«çš„ä»€ä¹ˆï¼Œéƒ½å¯ä»¥ï¼Œçœ‹ä½ æ€ä¹ˆå®ç°ã€‚
        0, play_sound("greeting.wav")
        6, set_animation("wave").play_sound("wave_sound.wav")
        17, set_color("#FF6B6B")
    ]
    // å½“æˆ‘ä»¬å†æ¬¡ä½¿ç”¨ text å­—æ®µæ—¶ï¼Œè¡¨ç¤ºè¿™æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹çš„å¦ä¸€ä¸ªæ–‡æœ¬å—ã€‚
    // ä½ å¯ä»¥å†™è‹¥å¹²ä¸ª text å—ï¼Œå®ƒä»¬ä¼šè¢«é¡ºåºæ’­æ”¾ã€‚
    text: $"æˆ‘æƒ³ä½ çš„åå­—æ˜¯ {get_name()}ï¼Œå¯¹ä¸ï¼Ÿ"
    events: [
        // ç´¢å¼•å¯ä»¥æ˜¯æµ®ç‚¹æ•°ï¼ä¸€èˆ¬æ¥è¯´ï¼Œè¯­éŸ³åŒæ­¥ä¼šç”¨åˆ°å°æ•°ç‚¹ã€‚è€Œæ‰“å­—æœºåˆ™æ˜¯æ•´æ•°ã€‚
        // å®é™…ä¸Šï¼Œmortar ä¸­çš„æ•°å­—éƒ½æ˜¯ Numberï¼Œè¿™å’Œ json é‡Œçš„æ•°å­—ç±»å‹æ˜¯ä¸€æ ·çš„ã€‚
        4.2, set_color("#33CCFF")
        10.8, set_color("#FF6B6B")
    ]

    // è¿™ä¸ª text å—æ²¡æœ‰ eventsâ€¦â€¦ è¿™æ˜¯å®Œå…¨åˆæ³•çš„ï¼
    text: "å¤ªå¥½å•¦ï¼Œæˆ‘ä»¬èµ°ï¼"

// èŠ‚ç‚¹åé¢çš„ç®­å¤´è¡¨ç¤ºè·³è½¬åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚
} -> ChoicePoint

/*
è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå±•ç¤ºäº†å¦‚ä½•ç¼–å†™é€‰é¡¹â€”â€”é€šè¿‡é€‰æ‹©å­—æ®µå®ç°ã€‚
*/

node ChoicePoint {
    text: "ä½ æƒ³å¹²ç‚¹å•¥ï¼Ÿ"

    // é€šè¿‡é€‰æ‹©å­—æ®µï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è·³è½¬åˆ°ä¸åŒçš„èŠ‚ç‚¹ã€‚
    choice: [
        // è¿™ä¸ªé€‰é¡¹æ²¡æœ‰ä»»ä½•æ¡ä»¶åˆ¤æ–­ã€‚æŒ‰ç†æ¥è¯´ï¼Œä½ å§‹ç»ˆå¯ä»¥é€‰æ‹©å®ƒã€‚
        "æ¢ç´¢æ£®æ—" -> ForestScene,

        // è¿™ä¸¤ä¸ªé€‰é¡¹å¸¦æœ‰ when å…³é”®å­—ï¼Œè¿™è¯´æ˜å®ƒä»¬å¸¦æœ‰æ¡ä»¶åˆ¤æ–­ï¼
        // when å…³é”®å­—æ”¯æŒ é“¾å¼å†™æ³• å’Œ å‡½æ•°å¼å†™æ³•ã€‚
        ("ç•™åœ¨åŸé‡Œ").when(has_map) -> TownScene,
        "æŸ¥çœ‹èƒŒåŒ…" when has_backpack  -> Inventory,

        // é€‰æ‹©å­—æ®µä¹Ÿå¯ä»¥åµŒå¥—ä¸€ä¸ªé€‰æ‹©å­—æ®µã€‚ä½ æƒ³åµŒå¥—å¤šå°‘å±‚éƒ½è¡Œï¼
        "åƒç‚¹ä»€ä¹ˆ" -> [
            "Apple" -> EatApple,
            "Bread" -> EatBread
        ]

        // ä½¿ç”¨ return å…³é”®å­— é€€å‡ºå½“å‰èŠ‚ç‚¹ã€‚
        // é¡ºå¸¦ä¸€æï¼Œå¦‚æœè¿™ä¸ªèŠ‚ç‚¹æœ‰åç»­èŠ‚ç‚¹ï¼Œé‚£ return ä¸ä¼šç»ˆæ­¢æ•´ä¸ªå¯¹è¯æµç¨‹ï¼Œåªä¼šé€€å‡ºå½“å‰èŠ‚ç‚¹ã€‚
        "åˆ«æœæˆ‘å­å­äº†ï¼ï¼" -> return,

        // ä½¿ç”¨ break å…³é”®å­— ç»ˆæ­¢é€‰é¡¹åˆ—è¡¨ã€‚
        "æˆ‘ä¸åˆ°å•Šâ€¦â€¦" -> break,
    ],

    // åœ¨è¿™ä¸ªé€‰æ‹©å­—æ®µä¸­ï¼Œåªæœ‰ä½ é€‰äº† "æˆ‘ä¸åˆ°å•Šâ€¦â€¦"ï¼Œæ‰ä¼šæ¥åˆ°è¿™ä¸€è¡Œã€‚
    text: "æˆ‘çœŸæœäº†ã€‚é‚£å’±å°±å…ˆç»“æŸå¯¹è¯å§ã€‚",

    // ç„¶åï¼Œç”±äºæ²¡æœ‰ä»»ä½•åç»­èŠ‚ç‚¹ï¼Œè¿™ä¸ªå¯¹è¯è¿˜æ˜¯ç»“æŸäº†ã€‚
}

// åœ¨ start ä¸­è°ƒç”¨çš„å‡½æ•°ä¸æ˜¯å¹³ç™½æ— æ•…å°±å‡ºç°çš„â€”â€”ä½ éœ€è¦åœ¨ Mortar æ–‡ä»¶ä¸­å®šä¹‰å®ƒä»¬ï¼
// è¿™æœ‰ç‚¹åƒæ˜¯ C / C++ é‡Œçš„å‡½æ•°å£°æ˜ã€‚å®ƒä»¬æœ€ç»ˆä¼šè¢«ç¼–è¯‘å™¨è¯†åˆ«å¹¶å…³è”åˆ°ä½ çš„æ¸¸æˆä»£ç ä¸­ã€‚
fn play_sound(file_name: String)

fn set_animation(anim_name: String)

fn set_color(value: String)

fn get_name() -> String

// fn å¯ä»¥å†™ä½œ function ï¼ŒBool ä¹Ÿå¯ä»¥å†™ä½œ Booleanã€‚
function has_map() -> Bool

fn has_backpack() -> Boolean
```

ç¼–è¯‘è¯¥ Mortar æ–‡ä»¶ï¼š

```bash
# åŸºç¡€ç¼–è¯‘ï¼ˆé»˜è®¤è¾“å‡ºå‹ç¼©æ ¼å¼çš„ JSONï¼‰
mortar hello.mortar

# ç”Ÿæˆå¸¦ç¼©è¿›çš„æ ¼å¼åŒ– JSON
mortar hello.mortar --pretty

# æŒ‡å®šè¾“å‡ºæ–‡ä»¶
mortar hello.mortar -o output_file

# ç»„åˆé€‰é¡¹
mortar hello.mortar -o custom.json --pretty
```

ç¼–è¯‘å™¨ç°åœ¨é»˜è®¤ç”Ÿæˆå‹ç¼©æ ¼å¼çš„ JSON ä»¥è·å¾—æœ€ä¼˜çš„æ–‡ä»¶å¤§å°å’Œæ€§èƒ½è¡¨ç°ã€‚å½“éœ€è¦äººç±»å¯è¯»çš„æ ¼å¼åŒ–è¾“å‡ºç”¨äºè°ƒè¯•æˆ–æŸ¥çœ‹æ—¶ï¼Œè¯·ä½¿ç”¨ `--pretty` æ ‡å¿—ã€‚

## é€‚ç”¨åœºæ™¯

* ğŸ® **æ¸¸æˆå¯¹è¯ç³»ç»Ÿ**ï¼šRPG å¯¹è¯ã€è§†è§‰å°è¯´
* ğŸ“– **äº¤äº’å°è¯´**ï¼šæ–‡å­—å†’é™©ã€åˆ†æ”¯å™äº‹
* ğŸ“š **æ•™è‚²å†…å®¹**ï¼šäº’åŠ¨å¼æ•™å­¦ã€å¼•å¯¼å¼å­¦ä¹ åœºæ™¯
* ğŸ¤– **èŠå¤©è„šæœ¬**ï¼šç»“æ„åŒ–å¯¹è¯é€»è¾‘
* ğŸ–¼ï¸ **å¤šåª’ä½“å‘ˆç°**ï¼šæ–‡å­—ä¸åª’ä½“äº‹ä»¶çš„åŒæ­¥

## å¼€å‘è¿›åº¦

å®ç°åŠŸèƒ½ï¼š

* âœ… **å‘½ä»¤è¡Œå·¥å…·**ï¼šå®Œæ•´ CLI ç¼–è¯‘å™¨
* âœ… **è¯æ³•åˆ†æå™¨**ï¼šä½¿ç”¨ logos å®ç°çš„é«˜æ€§èƒ½åˆ†è¯
* âœ… **è§£ææ¡†æ¶**ï¼šæ”¯æŒå®Œæ•´çš„ token è§£æ
* âœ… **AST ç»“æ„**ï¼šå®Œæ•´çš„æŠ½è±¡è¯­æ³•æ ‘å®šä¹‰
* âœ… **é”™è¯¯å¤„ç†**ï¼šariadne å‹å¥½çš„é”™è¯¯æŠ¥å‘Š
* âœ… **JSON è¾“å‡º**ï¼šæ ‡å‡†åŒ–è¾“å‡ºæ ¼å¼
* âœ… **è¯­è¨€æœåŠ¡å™¨**ï¼šIDE é›†æˆä¸è¯­æ³•é«˜äº®

è®¡åˆ’ä¸­åŠŸèƒ½ï¼š
* ğŸš§ **é”®å€¼å¯¹è§£æ**ï¼šæ”¯æŒç¼–å†™éå¯¹è¯æ–‡æœ¬
* ğŸš§ **æ¼”å‡ºç³»ç»Ÿ**ï¼šå°†events æå–æˆ ç‹¬ç«‹èŠ‚ç‚¹
* ğŸš§ **æ¡ä»¶è¡¨è¾¾å¼**ï¼šä¸ã€æˆ–ã€éï¼Œæ¯”è¾ƒ
* ğŸš§ **åˆ¤æ–­ã€å¾ªç¯è¯­å¥**ï¼šifï¼Œelseï¼Œwhile
* ğŸš§ **æœ¬åœ°åŒ–æ”¯æŒ**ï¼šå‚è€ƒ [Fluent](https://github.com/projectfluent/fluent) å®ç°æœ¬åœ°åŒ–æ”¯æŒ

## å‚ä¸è´¡çŒ®

æ¬¢è¿ç¤¾åŒºè´¡çŒ®ï¼è¯¦ç»†ä¿¡æ¯è¯·å‚é˜… [è´¡çŒ®æŒ‡å—](./CONTRIBUTING.md)ã€‚

### è´¡çŒ®è€…

ä»¥ä¸‹äººå‘˜ä¸ºæœ¬é¡¹ç›®åšå‡ºäº†è´¡çŒ®ã€‚

<a href = "https://github.com/Bli-AIk/mortar/Python/graphs/contributors">
<img src = "https://contrib.rocks/image?repo=Bli-AIk/mortar" alt=""/>
</a>

**è¡·å¿ƒæ„Ÿè°¢ä½ ä»¬æ¯ä¸€ä¸ªäººï¼ğŸ”**

## é¡¹ç›®ç»“æ„

æœ¬é¡¹ç›®é‡‡ç”¨ Rust workspace ç»„ç»‡ï¼ŒåŒ…å«å››ä¸ªä¸»è¦çš„ crateï¼š

* **`mortar_language`** - ä¸»è¦çš„åº“ crateï¼Œé‡æ–°å¯¼å‡ºæ‰€æœ‰å…¶ä»– crate çš„åŠŸèƒ½
* **`mortar_compiler`** - æ ¸å¿ƒç¼–è¯‘åº“ï¼ŒåŒ…å«è¯æ³•åˆ†æã€è¯­æ³•è§£æå’Œä»£ç ç”Ÿæˆ
* **`mortar_cli`** - å‘½ä»¤è¡Œç•Œé¢ï¼Œæä¾› `mortar` å‘½ä»¤
* **`mortar_lsp`** - è¯­è¨€æœåŠ¡å™¨åè®®å®ç°ï¼Œç”¨äº IDE é›†æˆ

### æ„å»ºé¡¹ç›®

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/Bli-AIk/mortar.git
cd mortar

# æ„å»º workspace ä¸­çš„æ‰€æœ‰ crate
cargo build

# æ„å»ºä¼˜åŒ–çš„ release ç‰ˆæœ¬
cargo build --release

# æ„å»ºç‰¹å®šçš„ crate
cargo build -p mortar_cli
cargo build -p mortar_compiler
cargo build -p mortar_language
cargo build -p mortar_lsp

# è¿è¡Œæ‰€æœ‰ crate çš„æµ‹è¯•
cargo test

# è¿è¡Œç‰¹å®š crate çš„æµ‹è¯•
cargo test -p mortar_compiler

# ä»£ç æ£€æŸ¥
cargo clippy

# æ ¼å¼åŒ–ä»£ç 
cargo fmt
```

### å®‰è£…å•ä¸ªç»„ä»¶

```bash
# ä»…å®‰è£… CLI å·¥å…·
cargo install mortar_cli

# ä»…å®‰è£… LSP æœåŠ¡å™¨
cargo install mortar_lsp

# åœ¨ Cargo.toml ä¸­ä½œä¸ºåº“ä¾èµ–ä½¿ç”¨
[dependencies]
mortar_language = "0.3"
# æˆ–ä½¿ç”¨å•ä¸ªç»„ä»¶
mortar_compiler = "0.3"
```

## è®¸å¯åè®®

Mortar é‡‡ç”¨åŒè®¸å¯è¯æ¨¡å¼ï¼š

### MIT License

å…è®¸ä»»ä½•äººå…è´¹ä½¿ç”¨ã€å¤åˆ¶ã€ä¿®æ”¹ã€åˆ†å‘æœ¬è½¯ä»¶ã€‚

### Apache License 2.0

åœ¨ Apache 2.0 è®¸å¯ä¸‹åˆ†å‘ã€‚

ä½ å¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©å…¶ä¸­ä»»æ„ä¸€ç§è®¸å¯è¯ã€‚
è¯¦è§ [LICENSE-MIT](./LICENSE-MIT) ä¸ [LICENSE-APACHE](./LICENSE-APACHE)ã€‚

## ç¤¾åŒº

* **GitHub Issues**ï¼š[æŠ¥å‘Šé—®é¢˜æˆ–æå‡ºåŠŸèƒ½å»ºè®®](https://github.com/Bli-AIk/mortar/issues)
* **è®¨è®ºåŒº**ï¼š[ç¤¾åŒºé—®ç­”ä¸è®¨è®º](https://github.com/Bli-AIk/mortar/discussions)

## ç›¸å…³é¡¹ç›®

* [ink](https://github.com/inkle/ink) â€”â€” Inkle çš„å™äº‹è„šæœ¬è¯­è¨€
* [Yarn Spinner](https://github.com/YarnSpinnerTool/YarnSpinner) â€”â€” ç”¨äºæ„å»ºäº’åŠ¨å¯¹è¯çš„å·¥å…·

## è‡´è°¢

ç‰¹åˆ«æ„Ÿè°¢ ink ä¸ Yarn Spinner çš„ä½œè€…ä»¬ï¼Œä¸ºäº’åŠ¨å™äº‹å·¥å…·å¼€è¾Ÿäº†é“è·¯ã€‚

åŒæ—¶æ„Ÿè°¢ Rust ç¤¾åŒºæä¾›äº†ä¼˜å¼‚çš„è§£æä¸ç¼–è¯‘ç›¸å…³åº“ï¼Œä½¿ Mortar å¾—ä»¥è¯ç”Ÿã€‚
